{"ast":null,"code":"import { geometry as g, throttle } from '@progress/kendo-drawing';\nimport { Class, addClass, deepExtend, round, limitValue, hashKey, setDefaultOptions } from '../../common';\nimport { removeChildren } from '../utils';\nimport { Layer } from './layer';\nimport TemplateService from '../../services/template-service';\nvar math = Math,\n    template = TemplateService.compile,\n    Point = g.Point;\n\nfunction roundPoint(point) {\n  return new Point(round(point.x), round(point.y));\n}\n\nfunction renderSize(size) {\n  var newSize = size;\n\n  if (typeof size !== \"string\") {\n    newSize += \"px\";\n  }\n\n  return newSize;\n}\n\nexport var TileLayer = function (Layer) {\n  function TileLayer(map, options) {\n    Layer.call(this, map, options);\n\n    if (typeof this.options.subdomains === 'string') {\n      this.options.subdomains = this.options.subdomains.split('');\n    }\n\n    var viewType = this._viewType();\n\n    this._view = new viewType(this.element, this.options);\n  }\n\n  if (Layer) TileLayer.__proto__ = Layer;\n  TileLayer.prototype = Object.create(Layer && Layer.prototype);\n  TileLayer.prototype.constructor = TileLayer;\n\n  TileLayer.prototype.destroy = function destroy() {\n    Layer.prototype.destroy.call(this);\n\n    this._view.destroy();\n\n    this._view = null;\n  };\n\n  TileLayer.prototype._beforeReset = function _beforeReset() {\n    var map = this.map;\n    var origin = map.locationToLayer(map.extent().nw).round();\n\n    this._view.viewOrigin(origin);\n  };\n\n  TileLayer.prototype._reset = function _reset() {\n    Layer.prototype._reset.call(this);\n\n    this._updateView();\n\n    this._view.reset();\n  };\n\n  TileLayer.prototype._viewType = function _viewType() {\n    return TileView;\n  };\n\n  TileLayer.prototype._activate = function _activate() {\n    Layer.prototype._activate.call(this);\n\n    if (!this.support.mobileOS) {\n      if (!this._pan) {\n        this._pan = throttle(this._render.bind(this), 100);\n      }\n\n      this.map.bind('pan', this._pan);\n    }\n  };\n\n  TileLayer.prototype._deactivate = function _deactivate() {\n    Layer.prototype._deactivate.call(this);\n\n    if (this._pan) {\n      this.map.unbind('pan', this._pan);\n    }\n  };\n\n  TileLayer.prototype._updateView = function _updateView() {\n    var view = this._view,\n        map = this.map,\n        extent = map.extent(),\n        extentToPoint = {\n      nw: map.locationToLayer(extent.nw).round(),\n      se: map.locationToLayer(extent.se).round()\n    };\n    view.center(map.locationToLayer(map.center()));\n    view.extent(extentToPoint);\n    view.zoom(map.zoom());\n  };\n\n  TileLayer.prototype._resize = function _resize() {\n    this._render();\n  };\n\n  TileLayer.prototype._panEnd = function _panEnd(e) {\n    Layer.prototype._panEnd.call(this, e);\n\n    this._render();\n  };\n\n  TileLayer.prototype._render = function _render() {\n    this._updateView();\n\n    this._view.render();\n  };\n\n  return TileLayer;\n}(Layer);\nsetDefaultOptions(TileLayer, {\n  tileSize: 256,\n  subdomains: ['a', 'b', 'c'],\n  urlTemplate: '',\n  zIndex: 1\n});\nexport var TileView = function (Class) {\n  function TileView(element, options) {\n    Class.call(this);\n    this.element = element;\n\n    this._initOptions(options);\n\n    this.pool = new TilePool();\n  }\n\n  if (Class) TileView.__proto__ = Class;\n  TileView.prototype = Object.create(Class && Class.prototype);\n  TileView.prototype.constructor = TileView;\n\n  TileView.prototype._initOptions = function _initOptions(options) {\n    this.options = deepExtend({}, this.options, options);\n  };\n\n  TileView.prototype.center = function center(center$1) {\n    this._center = center$1;\n  };\n\n  TileView.prototype.extent = function extent(extent$1) {\n    this._extent = extent$1;\n  };\n\n  TileView.prototype.viewOrigin = function viewOrigin(origin) {\n    this._viewOrigin = origin;\n  };\n\n  TileView.prototype.zoom = function zoom(zoom$1) {\n    this._zoom = zoom$1;\n  };\n\n  TileView.prototype.pointToTileIndex = function pointToTileIndex(point) {\n    return new Point(math.floor(point.x / this.options.tileSize), math.floor(point.y / this.options.tileSize));\n  };\n\n  TileView.prototype.tileCount = function tileCount() {\n    var size = this.size(),\n        firstTileIndex = this.pointToTileIndex(this._extent.nw),\n        nw = this._extent.nw,\n        point = this.indexToPoint(firstTileIndex).translate(-nw.x, -nw.y);\n    return {\n      x: math.ceil((math.abs(point.x) + size.width) / this.options.tileSize),\n      y: math.ceil((math.abs(point.y) + size.height) / this.options.tileSize)\n    };\n  };\n\n  TileView.prototype.size = function size() {\n    var nw = this._extent.nw,\n        se = this._extent.se,\n        diff = se.clone().translate(-nw.x, -nw.y);\n    return {\n      width: diff.x,\n      height: diff.y\n    };\n  };\n\n  TileView.prototype.indexToPoint = function indexToPoint(index) {\n    var x = index.x,\n        y = index.y;\n    return new Point(x * this.options.tileSize, y * this.options.tileSize);\n  };\n\n  TileView.prototype.subdomainText = function subdomainText() {\n    var subdomains = this.options.subdomains;\n    return subdomains[this.subdomainIndex++ % subdomains.length];\n  };\n\n  TileView.prototype.destroy = function destroy() {\n    removeChildren(this.element);\n    this.pool.empty();\n  };\n\n  TileView.prototype.reset = function reset() {\n    this.pool.reset();\n    this.subdomainIndex = 0;\n    this.render();\n  };\n\n  TileView.prototype.render = function render() {\n    var this$1 = this;\n    var size = this.tileCount(),\n        firstTileIndex = this.pointToTileIndex(this._extent.nw),\n        tile,\n        x,\n        y;\n\n    for (x = 0; x < size.x; x++) {\n      for (y = 0; y < size.y; y++) {\n        tile = this$1.createTile({\n          x: firstTileIndex.x + x,\n          y: firstTileIndex.y + y\n        });\n\n        if (!tile.visible) {\n          tile.show();\n        }\n      }\n    }\n  };\n\n  TileView.prototype.createTile = function createTile(currentIndex) {\n    var options = this.tileOptions(currentIndex);\n    var tile = this.pool.get(this._center, options);\n\n    if (!tile.element.parentNode) {\n      this.element.append(tile.element);\n    }\n\n    return tile;\n  };\n\n  TileView.prototype.tileOptions = function tileOptions(currentIndex) {\n    var index = this.wrapIndex(currentIndex),\n        point = this.indexToPoint(currentIndex),\n        origin = this._viewOrigin,\n        offset = point.clone().translate(-origin.x, -origin.y);\n    return {\n      index: index,\n      currentIndex: currentIndex,\n      point: point,\n      offset: roundPoint(offset),\n      zoom: this._zoom,\n      size: this.options.tileSize,\n      subdomain: this.subdomainText(),\n      urlTemplate: this.options.urlTemplate,\n      errorUrlTemplate: this.options.errorUrlTemplate\n    };\n  };\n\n  TileView.prototype.wrapIndex = function wrapIndex(index) {\n    var boundary = math.pow(2, this._zoom);\n    return {\n      x: this.wrapValue(index.x, boundary),\n      y: limitValue(index.y, 0, boundary - 1)\n    };\n  };\n\n  TileView.prototype.wrapValue = function wrapValue(value, boundary) {\n    var remainder = math.abs(value) % boundary;\n    var wrappedValue = value;\n\n    if (value >= 0) {\n      wrappedValue = remainder;\n    } else {\n      wrappedValue = boundary - (remainder === 0 ? boundary : remainder);\n    }\n\n    return wrappedValue;\n  };\n\n  return TileView;\n}(Class);\nexport var ImageTile = function (Class) {\n  function ImageTile(id, options) {\n    Class.call(this);\n    this.id = id;\n    this.visible = true;\n\n    this._initOptions(options);\n\n    this.createElement();\n    this.show();\n  }\n\n  if (Class) ImageTile.__proto__ = Class;\n  ImageTile.prototype = Object.create(Class && Class.prototype);\n  ImageTile.prototype.constructor = ImageTile;\n\n  ImageTile.prototype.destroy = function destroy() {\n    var element = this.element;\n    var parentNode = element ? element.parentNode : null;\n\n    if (element) {\n      if (parentNode) {\n        parentNode.removeChild(element);\n      }\n\n      this.element = null;\n    }\n  };\n\n  ImageTile.prototype._initOptions = function _initOptions(options) {\n    this.options = deepExtend({}, this.options, options);\n  };\n\n  ImageTile.prototype.createElement = function createElement() {\n    var el = document.createElement(\"img\");\n    addClass(el, \"k-layer\");\n    el.style.position = \"absolute\";\n    el.style.display = \"block\";\n    el.style.width = this.options.size;\n    el.style.height = this.options.size;\n    this.element = el; // todo\n    // add on error handler\n    // this.element =\n    // $('<img style=\\'position: absolute; display: block;\\' alt=\\'\\' />')\n    // .css({\n    //     width: this.options.size,\n    //     height: this.options.size\n    // })\n    // .on('error', proxy(function(e) {\n    //     if (this.errorUrl()) {\n    //         e.target.setAttribute('src', this.errorUrl());\n    //     } else {\n    //         e.target.removeAttribute('src');\n    //     }\n    // }, this));\n  };\n\n  ImageTile.prototype.show = function show() {\n    var element = this.element;\n    element.style.top = renderSize(this.options.offset.y);\n    element.style.left = renderSize(this.options.offset.x);\n    var url = this.url();\n\n    if (url) {\n      element.setAttribute('src', url);\n    }\n\n    element.style.visibility = 'visible';\n    this.visible = true;\n  };\n\n  ImageTile.prototype.hide = function hide() {\n    this.element.style.visibility = 'hidden';\n    this.visible = false;\n  };\n\n  ImageTile.prototype.url = function url() {\n    var urlResult = template(this.options.urlTemplate);\n    return urlResult(this.urlOptions());\n  };\n\n  ImageTile.prototype.errorUrl = function errorUrl() {\n    var urlResult = template(this.options.errorUrlTemplate);\n    return urlResult(this.urlOptions());\n  };\n\n  ImageTile.prototype.urlOptions = function urlOptions() {\n    var options = this.options;\n    return {\n      zoom: options.zoom,\n      subdomain: options.subdomain,\n      z: options.zoom,\n      x: options.index.x,\n      y: options.index.y,\n      s: options.subdomain,\n      quadkey: options.quadkey,\n      q: options.quadkey,\n      culture: options.culture,\n      c: options.culture\n    };\n  };\n\n  return ImageTile;\n}(Class);\nsetDefaultOptions(ImageTile, {\n  urlTemplate: '',\n  errorUrlTemplate: ''\n});\nexport var TilePool = function (Class) {\n  function TilePool() {\n    Class.call(this);\n    this._items = [];\n  }\n\n  if (Class) TilePool.__proto__ = Class;\n  TilePool.prototype = Object.create(Class && Class.prototype);\n  TilePool.prototype.constructor = TilePool;\n\n  TilePool.prototype.get = function get(center, options) {\n    if (this._items.length >= this.options.maxSize) {\n      this._remove(center);\n    }\n\n    return this._create(options);\n  };\n\n  TilePool.prototype.empty = function empty() {\n    var items = this._items;\n\n    for (var i = 0; i < items.length; i++) {\n      items[i].destroy();\n    }\n\n    this._items = [];\n  };\n\n  TilePool.prototype.reset = function reset() {\n    var items = this._items;\n\n    for (var i = 0; i < items.length; i++) {\n      items[i].hide();\n    }\n  };\n\n  TilePool.prototype._create = function _create(options) {\n    var items = this._items;\n    var tile;\n    var id = hashKey(options.point.toString() + options.offset.toString() + options.zoom + options.urlTemplate);\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].id === id) {\n        tile = items[i];\n        break;\n      }\n    }\n\n    if (tile) {\n      tile.show();\n    } else {\n      tile = new ImageTile(id, options);\n\n      this._items.push(tile);\n    }\n\n    return tile;\n  };\n\n  TilePool.prototype._remove = function _remove(center) {\n    var items = this._items;\n    var maxDist = -1;\n    var index = -1;\n\n    for (var i = 0; i < items.length; i++) {\n      var dist = items[i].options.point.distanceTo(center);\n\n      if (dist > maxDist && !items[i].visible) {\n        index = i;\n        maxDist = dist;\n      }\n    }\n\n    if (index !== -1) {\n      items[index].destroy();\n      items.splice(index, 1);\n    }\n  };\n\n  return TilePool;\n}(Class);\nsetDefaultOptions(TilePool, {\n  maxSize: 100\n});","map":{"version":3,"sources":["/home/meryem/repos/Movie_Trend_Visualizer/client/node_modules/@progress/kendo-charts/dist/es/map/layers/tile.js"],"names":["geometry","g","throttle","Class","addClass","deepExtend","round","limitValue","hashKey","setDefaultOptions","removeChildren","Layer","TemplateService","math","Math","template","compile","Point","roundPoint","point","x","y","renderSize","size","newSize","TileLayer","map","options","call","subdomains","split","viewType","_viewType","_view","element","__proto__","prototype","Object","create","constructor","destroy","_beforeReset","origin","locationToLayer","extent","nw","viewOrigin","_reset","_updateView","reset","TileView","_activate","support","mobileOS","_pan","_render","bind","_deactivate","unbind","view","extentToPoint","se","center","zoom","_resize","_panEnd","e","render","tileSize","urlTemplate","zIndex","_initOptions","pool","TilePool","center$1","_center","extent$1","_extent","_viewOrigin","zoom$1","_zoom","pointToTileIndex","floor","tileCount","firstTileIndex","indexToPoint","translate","ceil","abs","width","height","diff","clone","index","subdomainText","subdomainIndex","length","empty","this$1","tile","createTile","visible","show","currentIndex","tileOptions","get","parentNode","append","wrapIndex","offset","subdomain","errorUrlTemplate","boundary","pow","wrapValue","value","remainder","wrappedValue","ImageTile","id","createElement","removeChild","el","document","style","position","display","top","left","url","setAttribute","visibility","hide","urlResult","urlOptions","errorUrl","z","s","quadkey","q","culture","c","_items","maxSize","_remove","_create","items","i","toString","push","maxDist","dist","distanceTo","splice"],"mappings":"AAAA,SACIA,QAAQ,IAAIC,CADhB,EAEIC,QAFJ,QAGO,yBAHP;AAKA,SACIC,KADJ,EAEIC,QAFJ,EAGIC,UAHJ,EAIIC,KAJJ,EAKIC,UALJ,EAMIC,OANJ,EAOIC,iBAPJ,QAQO,cARP;AAUA,SAASC,cAAT,QAA+B,UAA/B;AAEA,SAASC,KAAT,QAAsB,SAAtB;AAEA,OAAOC,eAAP,MAA4B,iCAA5B;AAEA,IAAIC,IAAI,GAAGC,IAAX;AAAA,IACIC,QAAQ,GAAGH,eAAe,CAACI,OAD/B;AAAA,IAEIC,KAAK,GAAGhB,CAAC,CAACgB,KAFd;;AAIA,SAASC,UAAT,CAAoBC,KAApB,EAA2B;AACvB,SAAO,IAAIF,KAAJ,CAAUX,KAAK,CAACa,KAAK,CAACC,CAAP,CAAf,EAA0Bd,KAAK,CAACa,KAAK,CAACE,CAAP,CAA/B,CAAP;AACH;;AAED,SAASC,UAAT,CAAoBC,IAApB,EAA0B;AACtB,MAAIC,OAAO,GAAGD,IAAd;;AAEA,MAAI,OAAOA,IAAP,KAAiB,QAArB,EAA+B;AAC3BC,IAAAA,OAAO,IAAI,IAAX;AACH;;AAED,SAAOA,OAAP;AACH;;AAED,OAAO,IAAIC,SAAS,GAAI,UAAUd,KAAV,EAAiB;AACrC,WAASc,SAAT,CAAmBC,GAAnB,EAAwBC,OAAxB,EAAiC;AAC7BhB,IAAAA,KAAK,CAACiB,IAAN,CAAW,IAAX,EAAiBF,GAAjB,EAAsBC,OAAtB;;AAEA,QAAI,OAAO,KAAKA,OAAL,CAAaE,UAApB,KAAmC,QAAvC,EAAiD;AAC7C,WAAKF,OAAL,CAAaE,UAAb,GAA0B,KAAKF,OAAL,CAAaE,UAAb,CAAwBC,KAAxB,CAA8B,EAA9B,CAA1B;AACH;;AAED,QAAIC,QAAQ,GAAG,KAAKC,SAAL,EAAf;;AACA,SAAKC,KAAL,GAAa,IAAIF,QAAJ,CAAa,KAAKG,OAAlB,EAA2B,KAAKP,OAAhC,CAAb;AACH;;AAED,MAAKhB,KAAL,EAAac,SAAS,CAACU,SAAV,GAAsBxB,KAAtB;AACbc,EAAAA,SAAS,CAACW,SAAV,GAAsBC,MAAM,CAACC,MAAP,CAAe3B,KAAK,IAAIA,KAAK,CAACyB,SAA9B,CAAtB;AACAX,EAAAA,SAAS,CAACW,SAAV,CAAoBG,WAApB,GAAkCd,SAAlC;;AAEAA,EAAAA,SAAS,CAACW,SAAV,CAAoBI,OAApB,GAA8B,SAASA,OAAT,GAAoB;AAC9C7B,IAAAA,KAAK,CAACyB,SAAN,CAAgBI,OAAhB,CAAwBZ,IAAxB,CAA6B,IAA7B;;AACA,SAAKK,KAAL,CAAWO,OAAX;;AACA,SAAKP,KAAL,GAAa,IAAb;AACH,GAJD;;AAMAR,EAAAA,SAAS,CAACW,SAAV,CAAoBK,YAApB,GAAmC,SAASA,YAAT,GAAyB;AACxD,QAAIf,GAAG,GAAG,KAAKA,GAAf;AACA,QAAIgB,MAAM,GAAGhB,GAAG,CAACiB,eAAJ,CAAoBjB,GAAG,CAACkB,MAAJ,GAAaC,EAAjC,EAAqCvC,KAArC,EAAb;;AACA,SAAK2B,KAAL,CAAWa,UAAX,CAAsBJ,MAAtB;AACH,GAJD;;AAMAjB,EAAAA,SAAS,CAACW,SAAV,CAAoBW,MAApB,GAA6B,SAASA,MAAT,GAAmB;AAC5CpC,IAAAA,KAAK,CAACyB,SAAN,CAAgBW,MAAhB,CAAuBnB,IAAvB,CAA4B,IAA5B;;AACA,SAAKoB,WAAL;;AACA,SAAKf,KAAL,CAAWgB,KAAX;AACH,GAJD;;AAMAxB,EAAAA,SAAS,CAACW,SAAV,CAAoBJ,SAApB,GAAgC,SAASA,SAAT,GAAsB;AAClD,WAAOkB,QAAP;AACH,GAFD;;AAIAzB,EAAAA,SAAS,CAACW,SAAV,CAAoBe,SAApB,GAAgC,SAASA,SAAT,GAAsB;AAClDxC,IAAAA,KAAK,CAACyB,SAAN,CAAgBe,SAAhB,CAA0BvB,IAA1B,CAA+B,IAA/B;;AAEA,QAAI,CAAC,KAAKwB,OAAL,CAAaC,QAAlB,EAA4B;AACxB,UAAI,CAAC,KAAKC,IAAV,EAAgB;AACZ,aAAKA,IAAL,GAAYpD,QAAQ,CAAC,KAAKqD,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAAD,EAA0B,GAA1B,CAApB;AACH;;AAED,WAAK9B,GAAL,CAAS8B,IAAT,CAAc,KAAd,EAAqB,KAAKF,IAA1B;AACH;AACJ,GAVD;;AAYA7B,EAAAA,SAAS,CAACW,SAAV,CAAoBqB,WAApB,GAAkC,SAASA,WAAT,GAAwB;AACtD9C,IAAAA,KAAK,CAACyB,SAAN,CAAgBqB,WAAhB,CAA4B7B,IAA5B,CAAiC,IAAjC;;AAEA,QAAI,KAAK0B,IAAT,EAAe;AACX,WAAK5B,GAAL,CAASgC,MAAT,CAAgB,KAAhB,EAAuB,KAAKJ,IAA5B;AACH;AACJ,GAND;;AAQA7B,EAAAA,SAAS,CAACW,SAAV,CAAoBY,WAApB,GAAkC,SAASA,WAAT,GAAwB;AACtD,QAAIW,IAAI,GAAG,KAAK1B,KAAhB;AAAA,QACIP,GAAG,GAAG,KAAKA,GADf;AAAA,QAEIkB,MAAM,GAAGlB,GAAG,CAACkB,MAAJ,EAFb;AAAA,QAGIgB,aAAa,GAAG;AACZf,MAAAA,EAAE,EAAEnB,GAAG,CAACiB,eAAJ,CAAoBC,MAAM,CAACC,EAA3B,EAA+BvC,KAA/B,EADQ;AAEZuD,MAAAA,EAAE,EAAEnC,GAAG,CAACiB,eAAJ,CAAoBC,MAAM,CAACiB,EAA3B,EAA+BvD,KAA/B;AAFQ,KAHpB;AAQAqD,IAAAA,IAAI,CAACG,MAAL,CAAYpC,GAAG,CAACiB,eAAJ,CAAoBjB,GAAG,CAACoC,MAAJ,EAApB,CAAZ;AACAH,IAAAA,IAAI,CAACf,MAAL,CAAYgB,aAAZ;AACAD,IAAAA,IAAI,CAACI,IAAL,CAAUrC,GAAG,CAACqC,IAAJ,EAAV;AACH,GAZD;;AAcAtC,EAAAA,SAAS,CAACW,SAAV,CAAoB4B,OAApB,GAA8B,SAASA,OAAT,GAAoB;AAC9C,SAAKT,OAAL;AACH,GAFD;;AAIA9B,EAAAA,SAAS,CAACW,SAAV,CAAoB6B,OAApB,GAA8B,SAASA,OAAT,CAAkBC,CAAlB,EAAqB;AAC/CvD,IAAAA,KAAK,CAACyB,SAAN,CAAgB6B,OAAhB,CAAwBrC,IAAxB,CAA6B,IAA7B,EAAmCsC,CAAnC;;AACA,SAAKX,OAAL;AACH,GAHD;;AAKA9B,EAAAA,SAAS,CAACW,SAAV,CAAoBmB,OAApB,GAA8B,SAASA,OAAT,GAAoB;AAC9C,SAAKP,WAAL;;AACA,SAAKf,KAAL,CAAWkC,MAAX;AACH,GAHD;;AAKA,SAAO1C,SAAP;AACH,CAvFuB,CAuFtBd,KAvFsB,CAAjB;AAyFPF,iBAAiB,CAACgB,SAAD,EAAY;AACzB2C,EAAAA,QAAQ,EAAE,GADe;AAEzBvC,EAAAA,UAAU,EAAE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAFa;AAGzBwC,EAAAA,WAAW,EAAE,EAHY;AAIzBC,EAAAA,MAAM,EAAE;AAJiB,CAAZ,CAAjB;AAOA,OAAO,IAAIpB,QAAQ,GAAI,UAAU/C,KAAV,EAAiB;AACpC,WAAS+C,QAAT,CAAkBhB,OAAlB,EAA2BP,OAA3B,EAAoC;AAChCxB,IAAAA,KAAK,CAACyB,IAAN,CAAW,IAAX;AACA,SAAKM,OAAL,GAAeA,OAAf;;AACA,SAAKqC,YAAL,CAAkB5C,OAAlB;;AACA,SAAK6C,IAAL,GAAY,IAAIC,QAAJ,EAAZ;AACH;;AAED,MAAKtE,KAAL,EAAa+C,QAAQ,CAACf,SAAT,GAAqBhC,KAArB;AACb+C,EAAAA,QAAQ,CAACd,SAAT,GAAqBC,MAAM,CAACC,MAAP,CAAenC,KAAK,IAAIA,KAAK,CAACiC,SAA9B,CAArB;AACAc,EAAAA,QAAQ,CAACd,SAAT,CAAmBG,WAAnB,GAAiCW,QAAjC;;AAEAA,EAAAA,QAAQ,CAACd,SAAT,CAAmBmC,YAAnB,GAAkC,SAASA,YAAT,CAAuB5C,OAAvB,EAAgC;AAC9D,SAAKA,OAAL,GAAetB,UAAU,CAAC,EAAD,EAAK,KAAKsB,OAAV,EAAmBA,OAAnB,CAAzB;AACH,GAFD;;AAIAuB,EAAAA,QAAQ,CAACd,SAAT,CAAmB0B,MAAnB,GAA4B,SAASA,MAAT,CAAiBY,QAAjB,EAA2B;AACnD,SAAKC,OAAL,GAAeD,QAAf;AACH,GAFD;;AAIAxB,EAAAA,QAAQ,CAACd,SAAT,CAAmBQ,MAAnB,GAA4B,SAASA,MAAT,CAAiBgC,QAAjB,EAA2B;AACnD,SAAKC,OAAL,GAAeD,QAAf;AACH,GAFD;;AAIA1B,EAAAA,QAAQ,CAACd,SAAT,CAAmBU,UAAnB,GAAgC,SAASA,UAAT,CAAqBJ,MAArB,EAA6B;AACzD,SAAKoC,WAAL,GAAmBpC,MAAnB;AACH,GAFD;;AAIAQ,EAAAA,QAAQ,CAACd,SAAT,CAAmB2B,IAAnB,GAA0B,SAASA,IAAT,CAAegB,MAAf,EAAuB;AAC7C,SAAKC,KAAL,GAAaD,MAAb;AACH,GAFD;;AAIA7B,EAAAA,QAAQ,CAACd,SAAT,CAAmB6C,gBAAnB,GAAsC,SAASA,gBAAT,CAA2B9D,KAA3B,EAAkC;AACpE,WAAO,IAAIF,KAAJ,CAAUJ,IAAI,CAACqE,KAAL,CAAW/D,KAAK,CAACC,CAAN,GAAU,KAAKO,OAAL,CAAayC,QAAlC,CAAV,EAAuDvD,IAAI,CAACqE,KAAL,CAAW/D,KAAK,CAACE,CAAN,GAAU,KAAKM,OAAL,CAAayC,QAAlC,CAAvD,CAAP;AACH,GAFD;;AAIAlB,EAAAA,QAAQ,CAACd,SAAT,CAAmB+C,SAAnB,GAA+B,SAASA,SAAT,GAAsB;AACjD,QAAI5D,IAAI,GAAG,KAAKA,IAAL,EAAX;AAAA,QACI6D,cAAc,GAAG,KAAKH,gBAAL,CAAsB,KAAKJ,OAAL,CAAahC,EAAnC,CADrB;AAAA,QAEIA,EAAE,GAAG,KAAKgC,OAAL,CAAahC,EAFtB;AAAA,QAGI1B,KAAK,GAAG,KAAKkE,YAAL,CAAkBD,cAAlB,EAAkCE,SAAlC,CAA4C,CAACzC,EAAE,CAACzB,CAAhD,EAAmD,CAACyB,EAAE,CAACxB,CAAvD,CAHZ;AAKA,WAAO;AACHD,MAAAA,CAAC,EAAEP,IAAI,CAAC0E,IAAL,CAAU,CAAC1E,IAAI,CAAC2E,GAAL,CAASrE,KAAK,CAACC,CAAf,IAAoBG,IAAI,CAACkE,KAA1B,IAAmC,KAAK9D,OAAL,CAAayC,QAA1D,CADA;AAEH/C,MAAAA,CAAC,EAAER,IAAI,CAAC0E,IAAL,CAAU,CAAC1E,IAAI,CAAC2E,GAAL,CAASrE,KAAK,CAACE,CAAf,IAAoBE,IAAI,CAACmE,MAA1B,IAAoC,KAAK/D,OAAL,CAAayC,QAA3D;AAFA,KAAP;AAIH,GAVD;;AAYAlB,EAAAA,QAAQ,CAACd,SAAT,CAAmBb,IAAnB,GAA0B,SAASA,IAAT,GAAiB;AACvC,QAAIsB,EAAE,GAAG,KAAKgC,OAAL,CAAahC,EAAtB;AAAA,QACIgB,EAAE,GAAG,KAAKgB,OAAL,CAAahB,EADtB;AAAA,QAEI8B,IAAI,GAAG9B,EAAE,CAAC+B,KAAH,GAAWN,SAAX,CAAqB,CAACzC,EAAE,CAACzB,CAAzB,EAA4B,CAACyB,EAAE,CAACxB,CAAhC,CAFX;AAIA,WAAO;AACHoE,MAAAA,KAAK,EAAEE,IAAI,CAACvE,CADT;AAEHsE,MAAAA,MAAM,EAAEC,IAAI,CAACtE;AAFV,KAAP;AAIH,GATD;;AAWA6B,EAAAA,QAAQ,CAACd,SAAT,CAAmBiD,YAAnB,GAAkC,SAASA,YAAT,CAAuBQ,KAAvB,EAA8B;AAC5D,QAAIzE,CAAC,GAAGyE,KAAK,CAACzE,CAAd;AAAA,QACIC,CAAC,GAAGwE,KAAK,CAACxE,CADd;AAGA,WAAO,IAAIJ,KAAJ,CAAUG,CAAC,GAAG,KAAKO,OAAL,CAAayC,QAA3B,EAAqC/C,CAAC,GAAG,KAAKM,OAAL,CAAayC,QAAtD,CAAP;AACH,GALD;;AAOAlB,EAAAA,QAAQ,CAACd,SAAT,CAAmB0D,aAAnB,GAAmC,SAASA,aAAT,GAA0B;AACzD,QAAIjE,UAAU,GAAG,KAAKF,OAAL,CAAaE,UAA9B;AACA,WAAOA,UAAU,CAAC,KAAKkE,cAAL,KAAwBlE,UAAU,CAACmE,MAApC,CAAjB;AACH,GAHD;;AAKA9C,EAAAA,QAAQ,CAACd,SAAT,CAAmBI,OAAnB,GAA6B,SAASA,OAAT,GAAoB;AAC7C9B,IAAAA,cAAc,CAAC,KAAKwB,OAAN,CAAd;AACA,SAAKsC,IAAL,CAAUyB,KAAV;AACH,GAHD;;AAKA/C,EAAAA,QAAQ,CAACd,SAAT,CAAmBa,KAAnB,GAA2B,SAASA,KAAT,GAAkB;AACzC,SAAKuB,IAAL,CAAUvB,KAAV;AACA,SAAK8C,cAAL,GAAsB,CAAtB;AACA,SAAK5B,MAAL;AACH,GAJD;;AAMAjB,EAAAA,QAAQ,CAACd,SAAT,CAAmB+B,MAAnB,GAA4B,SAASA,MAAT,GAAmB;AAC3C,QAAI+B,MAAM,GAAG,IAAb;AAEA,QAAI3E,IAAI,GAAG,KAAK4D,SAAL,EAAX;AAAA,QACIC,cAAc,GAAG,KAAKH,gBAAL,CAAsB,KAAKJ,OAAL,CAAahC,EAAnC,CADrB;AAAA,QAEIsD,IAFJ;AAAA,QAEU/E,CAFV;AAAA,QAEaC,CAFb;;AAIA,SAAKD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGG,IAAI,CAACH,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AACzB,WAAKC,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGE,IAAI,CAACF,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AACzB8E,QAAAA,IAAI,GAAGD,MAAM,CAACE,UAAP,CAAkB;AACrBhF,UAAAA,CAAC,EAAEgE,cAAc,CAAChE,CAAf,GAAmBA,CADD;AAErBC,UAAAA,CAAC,EAAE+D,cAAc,CAAC/D,CAAf,GAAmBA;AAFD,SAAlB,CAAP;;AAKA,YAAI,CAAC8E,IAAI,CAACE,OAAV,EAAmB;AACfF,UAAAA,IAAI,CAACG,IAAL;AACH;AACJ;AACJ;AACJ,GAnBD;;AAqBApD,EAAAA,QAAQ,CAACd,SAAT,CAAmBgE,UAAnB,GAAgC,SAASA,UAAT,CAAqBG,YAArB,EAAmC;AAC/D,QAAI5E,OAAO,GAAG,KAAK6E,WAAL,CAAiBD,YAAjB,CAAd;AACA,QAAIJ,IAAI,GAAG,KAAK3B,IAAL,CAAUiC,GAAV,CAAc,KAAK9B,OAAnB,EAA4BhD,OAA5B,CAAX;;AAEA,QAAI,CAACwE,IAAI,CAACjE,OAAL,CAAawE,UAAlB,EAA8B;AAC1B,WAAKxE,OAAL,CAAayE,MAAb,CAAoBR,IAAI,CAACjE,OAAzB;AACH;;AAED,WAAOiE,IAAP;AACH,GATD;;AAWAjD,EAAAA,QAAQ,CAACd,SAAT,CAAmBoE,WAAnB,GAAiC,SAASA,WAAT,CAAsBD,YAAtB,EAAoC;AACjE,QAAIV,KAAK,GAAG,KAAKe,SAAL,CAAeL,YAAf,CAAZ;AAAA,QACIpF,KAAK,GAAG,KAAKkE,YAAL,CAAkBkB,YAAlB,CADZ;AAAA,QAEI7D,MAAM,GAAG,KAAKoC,WAFlB;AAAA,QAGI+B,MAAM,GAAG1F,KAAK,CAACyE,KAAN,GAAcN,SAAd,CAAwB,CAAC5C,MAAM,CAACtB,CAAhC,EAAmC,CAACsB,MAAM,CAACrB,CAA3C,CAHb;AAKA,WAAO;AACHwE,MAAAA,KAAK,EAAEA,KADJ;AAEHU,MAAAA,YAAY,EAAEA,YAFX;AAGHpF,MAAAA,KAAK,EAAEA,KAHJ;AAIH0F,MAAAA,MAAM,EAAE3F,UAAU,CAAC2F,MAAD,CAJf;AAKH9C,MAAAA,IAAI,EAAE,KAAKiB,KALR;AAMHzD,MAAAA,IAAI,EAAE,KAAKI,OAAL,CAAayC,QANhB;AAOH0C,MAAAA,SAAS,EAAE,KAAKhB,aAAL,EAPR;AAQHzB,MAAAA,WAAW,EAAE,KAAK1C,OAAL,CAAa0C,WARvB;AASH0C,MAAAA,gBAAgB,EAAE,KAAKpF,OAAL,CAAaoF;AAT5B,KAAP;AAWH,GAjBD;;AAmBA7D,EAAAA,QAAQ,CAACd,SAAT,CAAmBwE,SAAnB,GAA+B,SAASA,SAAT,CAAoBf,KAApB,EAA2B;AACtD,QAAImB,QAAQ,GAAGnG,IAAI,CAACoG,GAAL,CAAS,CAAT,EAAY,KAAKjC,KAAjB,CAAf;AAEA,WAAO;AACH5D,MAAAA,CAAC,EAAE,KAAK8F,SAAL,CAAerB,KAAK,CAACzE,CAArB,EAAwB4F,QAAxB,CADA;AAEH3F,MAAAA,CAAC,EAAEd,UAAU,CAACsF,KAAK,CAACxE,CAAP,EAAU,CAAV,EAAa2F,QAAQ,GAAG,CAAxB;AAFV,KAAP;AAIH,GAPD;;AASA9D,EAAAA,QAAQ,CAACd,SAAT,CAAmB8E,SAAnB,GAA+B,SAASA,SAAT,CAAoBC,KAApB,EAA2BH,QAA3B,EAAqC;AAChE,QAAII,SAAS,GAAGvG,IAAI,CAAC2E,GAAL,CAAS2B,KAAT,IAAkBH,QAAlC;AACA,QAAIK,YAAY,GAAGF,KAAnB;;AAEA,QAAIA,KAAK,IAAI,CAAb,EAAgB;AACZE,MAAAA,YAAY,GAAGD,SAAf;AACH,KAFD,MAEO;AACHC,MAAAA,YAAY,GAAGL,QAAQ,IAAII,SAAS,KAAK,CAAd,GAAkBJ,QAAlB,GAA6BI,SAAjC,CAAvB;AACH;;AAED,WAAOC,YAAP;AACH,GAXD;;AAaA,SAAOnE,QAAP;AACH,CA5JsB,CA4JrB/C,KA5JqB,CAAhB;AA8JP,OAAO,IAAImH,SAAS,GAAI,UAAUnH,KAAV,EAAiB;AACrC,WAASmH,SAAT,CAAmBC,EAAnB,EAAuB5F,OAAvB,EAAgC;AAC5BxB,IAAAA,KAAK,CAACyB,IAAN,CAAW,IAAX;AACA,SAAK2F,EAAL,GAAUA,EAAV;AACA,SAAKlB,OAAL,GAAe,IAAf;;AACA,SAAK9B,YAAL,CAAkB5C,OAAlB;;AACA,SAAK6F,aAAL;AACA,SAAKlB,IAAL;AACH;;AAED,MAAKnG,KAAL,EAAamH,SAAS,CAACnF,SAAV,GAAsBhC,KAAtB;AACbmH,EAAAA,SAAS,CAAClF,SAAV,GAAsBC,MAAM,CAACC,MAAP,CAAenC,KAAK,IAAIA,KAAK,CAACiC,SAA9B,CAAtB;AACAkF,EAAAA,SAAS,CAAClF,SAAV,CAAoBG,WAApB,GAAkC+E,SAAlC;;AAEAA,EAAAA,SAAS,CAAClF,SAAV,CAAoBI,OAApB,GAA8B,SAASA,OAAT,GAAoB;AAC9C,QAAIN,OAAO,GAAG,KAAKA,OAAnB;AACA,QAAIwE,UAAU,GAAGxE,OAAO,GAAGA,OAAO,CAACwE,UAAX,GAAwB,IAAhD;;AAEA,QAAIxE,OAAJ,EAAa;AACT,UAAIwE,UAAJ,EAAgB;AACZA,QAAAA,UAAU,CAACe,WAAX,CAAuBvF,OAAvB;AACH;;AAED,WAAKA,OAAL,GAAe,IAAf;AACH;AACJ,GAXD;;AAaAoF,EAAAA,SAAS,CAAClF,SAAV,CAAoBmC,YAApB,GAAmC,SAASA,YAAT,CAAuB5C,OAAvB,EAAgC;AAC/D,SAAKA,OAAL,GAAetB,UAAU,CAAC,EAAD,EAAK,KAAKsB,OAAV,EAAmBA,OAAnB,CAAzB;AACH,GAFD;;AAIA2F,EAAAA,SAAS,CAAClF,SAAV,CAAoBoF,aAApB,GAAoC,SAASA,aAAT,GAA0B;AAC1D,QAAIE,EAAE,GAAGC,QAAQ,CAACH,aAAT,CAAuB,KAAvB,CAAT;AACApH,IAAAA,QAAQ,CAACsH,EAAD,EAAK,SAAL,CAAR;AACAA,IAAAA,EAAE,CAACE,KAAH,CAASC,QAAT,GAAoB,UAApB;AACAH,IAAAA,EAAE,CAACE,KAAH,CAASE,OAAT,GAAmB,OAAnB;AACAJ,IAAAA,EAAE,CAACE,KAAH,CAASnC,KAAT,GAAiB,KAAK9D,OAAL,CAAaJ,IAA9B;AACAmG,IAAAA,EAAE,CAACE,KAAH,CAASlC,MAAT,GAAkB,KAAK/D,OAAL,CAAaJ,IAA/B;AAEA,SAAKW,OAAL,GAAewF,EAAf,CAR0D,CAU1D;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GA1BD;;AA4BAJ,EAAAA,SAAS,CAAClF,SAAV,CAAoBkE,IAApB,GAA2B,SAASA,IAAT,GAAiB;AACxC,QAAIpE,OAAO,GAAG,KAAKA,OAAnB;AACAA,IAAAA,OAAO,CAAC0F,KAAR,CAAcG,GAAd,GAAoBzG,UAAU,CAAC,KAAKK,OAAL,CAAakF,MAAb,CAAoBxF,CAArB,CAA9B;AACAa,IAAAA,OAAO,CAAC0F,KAAR,CAAcI,IAAd,GAAqB1G,UAAU,CAAC,KAAKK,OAAL,CAAakF,MAAb,CAAoBzF,CAArB,CAA/B;AAEA,QAAI6G,GAAG,GAAG,KAAKA,GAAL,EAAV;;AAEA,QAAIA,GAAJ,EAAS;AACL/F,MAAAA,OAAO,CAACgG,YAAR,CAAqB,KAArB,EAA4BD,GAA5B;AACH;;AAED/F,IAAAA,OAAO,CAAC0F,KAAR,CAAcO,UAAd,GAA2B,SAA3B;AACA,SAAK9B,OAAL,GAAe,IAAf;AACH,GAbD;;AAeAiB,EAAAA,SAAS,CAAClF,SAAV,CAAoBgG,IAApB,GAA2B,SAASA,IAAT,GAAiB;AACxC,SAAKlG,OAAL,CAAa0F,KAAb,CAAmBO,UAAnB,GAAgC,QAAhC;AACA,SAAK9B,OAAL,GAAe,KAAf;AACH,GAHD;;AAKAiB,EAAAA,SAAS,CAAClF,SAAV,CAAoB6F,GAApB,GAA0B,SAASA,GAAT,GAAgB;AACtC,QAAII,SAAS,GAAGtH,QAAQ,CAAC,KAAKY,OAAL,CAAa0C,WAAd,CAAxB;AACA,WAAOgE,SAAS,CAAC,KAAKC,UAAL,EAAD,CAAhB;AACH,GAHD;;AAKAhB,EAAAA,SAAS,CAAClF,SAAV,CAAoBmG,QAApB,GAA+B,SAASA,QAAT,GAAqB;AAChD,QAAIF,SAAS,GAAGtH,QAAQ,CAAC,KAAKY,OAAL,CAAaoF,gBAAd,CAAxB;AACA,WAAOsB,SAAS,CAAC,KAAKC,UAAL,EAAD,CAAhB;AACH,GAHD;;AAKAhB,EAAAA,SAAS,CAAClF,SAAV,CAAoBkG,UAApB,GAAiC,SAASA,UAAT,GAAuB;AACpD,QAAI3G,OAAO,GAAG,KAAKA,OAAnB;AAEA,WAAO;AACHoC,MAAAA,IAAI,EAAEpC,OAAO,CAACoC,IADX;AAEH+C,MAAAA,SAAS,EAAEnF,OAAO,CAACmF,SAFhB;AAGH0B,MAAAA,CAAC,EAAE7G,OAAO,CAACoC,IAHR;AAIH3C,MAAAA,CAAC,EAAEO,OAAO,CAACkE,KAAR,CAAczE,CAJd;AAKHC,MAAAA,CAAC,EAAEM,OAAO,CAACkE,KAAR,CAAcxE,CALd;AAMHoH,MAAAA,CAAC,EAAE9G,OAAO,CAACmF,SANR;AAOH4B,MAAAA,OAAO,EAAE/G,OAAO,CAAC+G,OAPd;AAQHC,MAAAA,CAAC,EAAEhH,OAAO,CAAC+G,OARR;AASHE,MAAAA,OAAO,EAAEjH,OAAO,CAACiH,OATd;AAUHC,MAAAA,CAAC,EAAElH,OAAO,CAACiH;AAVR,KAAP;AAYH,GAfD;;AAiBA,SAAOtB,SAAP;AACH,CA3GuB,CA2GtBnH,KA3GsB,CAAjB;AA6GPM,iBAAiB,CAAC6G,SAAD,EAAY;AACzBjD,EAAAA,WAAW,EAAE,EADY;AAEzB0C,EAAAA,gBAAgB,EAAE;AAFO,CAAZ,CAAjB;AAKA,OAAO,IAAItC,QAAQ,GAAI,UAAUtE,KAAV,EAAiB;AACpC,WAASsE,QAAT,GAAoB;AAChBtE,IAAAA,KAAK,CAACyB,IAAN,CAAW,IAAX;AACA,SAAKkH,MAAL,GAAc,EAAd;AACH;;AAED,MAAK3I,KAAL,EAAasE,QAAQ,CAACtC,SAAT,GAAqBhC,KAArB;AACbsE,EAAAA,QAAQ,CAACrC,SAAT,GAAqBC,MAAM,CAACC,MAAP,CAAenC,KAAK,IAAIA,KAAK,CAACiC,SAA9B,CAArB;AACAqC,EAAAA,QAAQ,CAACrC,SAAT,CAAmBG,WAAnB,GAAiCkC,QAAjC;;AAEAA,EAAAA,QAAQ,CAACrC,SAAT,CAAmBqE,GAAnB,GAAyB,SAASA,GAAT,CAAc3C,MAAd,EAAsBnC,OAAtB,EAA+B;AACpD,QAAI,KAAKmH,MAAL,CAAY9C,MAAZ,IAAsB,KAAKrE,OAAL,CAAaoH,OAAvC,EAAgD;AAC5C,WAAKC,OAAL,CAAalF,MAAb;AACH;;AAED,WAAO,KAAKmF,OAAL,CAAatH,OAAb,CAAP;AACH,GAND;;AAQA8C,EAAAA,QAAQ,CAACrC,SAAT,CAAmB6D,KAAnB,GAA2B,SAASA,KAAT,GAAkB;AACzC,QAAIiD,KAAK,GAAG,KAAKJ,MAAjB;;AAEA,SAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAAClD,MAA1B,EAAkCmD,CAAC,EAAnC,EAAuC;AACnCD,MAAAA,KAAK,CAACC,CAAD,CAAL,CAAS3G,OAAT;AACH;;AAED,SAAKsG,MAAL,GAAc,EAAd;AACH,GARD;;AAUArE,EAAAA,QAAQ,CAACrC,SAAT,CAAmBa,KAAnB,GAA2B,SAASA,KAAT,GAAkB;AACzC,QAAIiG,KAAK,GAAG,KAAKJ,MAAjB;;AAEA,SAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAAClD,MAA1B,EAAkCmD,CAAC,EAAnC,EAAuC;AACnCD,MAAAA,KAAK,CAACC,CAAD,CAAL,CAASf,IAAT;AACH;AACJ,GAND;;AAQA3D,EAAAA,QAAQ,CAACrC,SAAT,CAAmB6G,OAAnB,GAA6B,SAASA,OAAT,CAAkBtH,OAAlB,EAA2B;AACpD,QAAIuH,KAAK,GAAG,KAAKJ,MAAjB;AACA,QAAI3C,IAAJ;AACA,QAAIoB,EAAE,GAAG/G,OAAO,CAACmB,OAAO,CAACR,KAAR,CAAciI,QAAd,KAA2BzH,OAAO,CAACkF,MAAR,CAAeuC,QAAf,EAA3B,GAAuDzH,OAAO,CAACoC,IAA/D,GAAsEpC,OAAO,CAAC0C,WAA/E,CAAhB;;AAEA,SAAK,IAAI8E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAAClD,MAA1B,EAAkCmD,CAAC,EAAnC,EAAuC;AACnC,UAAID,KAAK,CAACC,CAAD,CAAL,CAAS5B,EAAT,KAAgBA,EAApB,EAAwB;AACpBpB,QAAAA,IAAI,GAAG+C,KAAK,CAACC,CAAD,CAAZ;AACA;AACH;AACJ;;AAED,QAAIhD,IAAJ,EAAU;AACNA,MAAAA,IAAI,CAACG,IAAL;AACH,KAFD,MAEO;AACHH,MAAAA,IAAI,GAAG,IAAImB,SAAJ,CAAcC,EAAd,EAAkB5F,OAAlB,CAAP;;AACA,WAAKmH,MAAL,CAAYO,IAAZ,CAAiBlD,IAAjB;AACH;;AAED,WAAOA,IAAP;AACH,GApBD;;AAsBA1B,EAAAA,QAAQ,CAACrC,SAAT,CAAmB4G,OAAnB,GAA6B,SAASA,OAAT,CAAkBlF,MAAlB,EAA0B;AACnD,QAAIoF,KAAK,GAAG,KAAKJ,MAAjB;AACA,QAAIQ,OAAO,GAAG,CAAC,CAAf;AACA,QAAIzD,KAAK,GAAG,CAAC,CAAb;;AAEA,SAAK,IAAIsD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAAClD,MAA1B,EAAkCmD,CAAC,EAAnC,EAAuC;AACnC,UAAII,IAAI,GAAGL,KAAK,CAACC,CAAD,CAAL,CAASxH,OAAT,CAAiBR,KAAjB,CAAuBqI,UAAvB,CAAkC1F,MAAlC,CAAX;;AAEA,UAAIyF,IAAI,GAAGD,OAAP,IAAkB,CAACJ,KAAK,CAACC,CAAD,CAAL,CAAS9C,OAAhC,EAAyC;AACrCR,QAAAA,KAAK,GAAGsD,CAAR;AACAG,QAAAA,OAAO,GAAGC,IAAV;AACH;AACJ;;AAED,QAAI1D,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdqD,MAAAA,KAAK,CAACrD,KAAD,CAAL,CAAarD,OAAb;AACA0G,MAAAA,KAAK,CAACO,MAAN,CAAa5D,KAAb,EAAoB,CAApB;AACH;AACJ,GAlBD;;AAoBA,SAAOpB,QAAP;AACH,CA/EsB,CA+ErBtE,KA/EqB,CAAhB;AAiFPM,iBAAiB,CAACgE,QAAD,EAAW;AACxBsE,EAAAA,OAAO,EAAE;AADe,CAAX,CAAjB","sourcesContent":["import {\n    geometry as g,\n    throttle\n} from '@progress/kendo-drawing';\n\nimport {\n    Class,\n    addClass,\n    deepExtend,\n    round,\n    limitValue,\n    hashKey,\n    setDefaultOptions\n} from '../../common';\n\nimport { removeChildren } from '../utils';\n\nimport { Layer } from './layer';\n\nimport TemplateService from '../../services/template-service';\n\nvar math = Math,\n    template = TemplateService.compile,\n    Point = g.Point;\n\nfunction roundPoint(point) {\n    return new Point(round(point.x), round(point.y));\n}\n\nfunction renderSize(size) {\n    var newSize = size;\n\n    if (typeof(size) !== \"string\") {\n        newSize += \"px\";\n    }\n\n    return newSize;\n}\n\nexport var TileLayer = (function (Layer) {\n    function TileLayer(map, options) {\n        Layer.call(this, map, options);\n\n        if (typeof this.options.subdomains === 'string') {\n            this.options.subdomains = this.options.subdomains.split('');\n        }\n\n        var viewType = this._viewType();\n        this._view = new viewType(this.element, this.options);\n    }\n\n    if ( Layer ) TileLayer.__proto__ = Layer;\n    TileLayer.prototype = Object.create( Layer && Layer.prototype );\n    TileLayer.prototype.constructor = TileLayer;\n\n    TileLayer.prototype.destroy = function destroy () {\n        Layer.prototype.destroy.call(this);\n        this._view.destroy();\n        this._view = null;\n    };\n\n    TileLayer.prototype._beforeReset = function _beforeReset () {\n        var map = this.map;\n        var origin = map.locationToLayer(map.extent().nw).round();\n        this._view.viewOrigin(origin);\n    };\n\n    TileLayer.prototype._reset = function _reset () {\n        Layer.prototype._reset.call(this);\n        this._updateView();\n        this._view.reset();\n    };\n\n    TileLayer.prototype._viewType = function _viewType () {\n        return TileView;\n    };\n\n    TileLayer.prototype._activate = function _activate () {\n        Layer.prototype._activate.call(this);\n\n        if (!this.support.mobileOS) {\n            if (!this._pan) {\n                this._pan = throttle(this._render.bind(this), 100);\n            }\n\n            this.map.bind('pan', this._pan);\n        }\n    };\n\n    TileLayer.prototype._deactivate = function _deactivate () {\n        Layer.prototype._deactivate.call(this);\n\n        if (this._pan) {\n            this.map.unbind('pan', this._pan);\n        }\n    };\n\n    TileLayer.prototype._updateView = function _updateView () {\n        var view = this._view,\n            map = this.map,\n            extent = map.extent(),\n            extentToPoint = {\n                nw: map.locationToLayer(extent.nw).round(),\n                se: map.locationToLayer(extent.se).round()\n            };\n\n        view.center(map.locationToLayer(map.center()));\n        view.extent(extentToPoint);\n        view.zoom(map.zoom());\n    };\n\n    TileLayer.prototype._resize = function _resize () {\n        this._render();\n    };\n\n    TileLayer.prototype._panEnd = function _panEnd (e) {\n        Layer.prototype._panEnd.call(this, e);\n        this._render();\n    };\n\n    TileLayer.prototype._render = function _render () {\n        this._updateView();\n        this._view.render();\n    };\n\n    return TileLayer;\n}(Layer));\n\nsetDefaultOptions(TileLayer, {\n    tileSize: 256,\n    subdomains: ['a', 'b', 'c'],\n    urlTemplate: '',\n    zIndex: 1\n});\n\nexport var TileView = (function (Class) {\n    function TileView(element, options) {\n        Class.call(this);\n        this.element = element;\n        this._initOptions(options);\n        this.pool = new TilePool();\n    }\n\n    if ( Class ) TileView.__proto__ = Class;\n    TileView.prototype = Object.create( Class && Class.prototype );\n    TileView.prototype.constructor = TileView;\n\n    TileView.prototype._initOptions = function _initOptions (options) {\n        this.options = deepExtend({}, this.options, options);\n    };\n\n    TileView.prototype.center = function center (center$1) {\n        this._center = center$1;\n    };\n\n    TileView.prototype.extent = function extent (extent$1) {\n        this._extent = extent$1;\n    };\n\n    TileView.prototype.viewOrigin = function viewOrigin (origin) {\n        this._viewOrigin = origin;\n    };\n\n    TileView.prototype.zoom = function zoom (zoom$1) {\n        this._zoom = zoom$1;\n    };\n\n    TileView.prototype.pointToTileIndex = function pointToTileIndex (point) {\n        return new Point(math.floor(point.x / this.options.tileSize), math.floor(point.y / this.options.tileSize));\n    };\n\n    TileView.prototype.tileCount = function tileCount () {\n        var size = this.size(),\n            firstTileIndex = this.pointToTileIndex(this._extent.nw),\n            nw = this._extent.nw,\n            point = this.indexToPoint(firstTileIndex).translate(-nw.x, -nw.y);\n\n        return {\n            x: math.ceil((math.abs(point.x) + size.width) / this.options.tileSize),\n            y: math.ceil((math.abs(point.y) + size.height) / this.options.tileSize)\n        };\n    };\n\n    TileView.prototype.size = function size () {\n        var nw = this._extent.nw,\n            se = this._extent.se,\n            diff = se.clone().translate(-nw.x, -nw.y);\n\n        return {\n            width: diff.x,\n            height: diff.y\n        };\n    };\n\n    TileView.prototype.indexToPoint = function indexToPoint (index) {\n        var x = index.x,\n            y = index.y;\n\n        return new Point(x * this.options.tileSize, y * this.options.tileSize);\n    };\n\n    TileView.prototype.subdomainText = function subdomainText () {\n        var subdomains = this.options.subdomains;\n        return subdomains[this.subdomainIndex++ % subdomains.length];\n    };\n\n    TileView.prototype.destroy = function destroy () {\n        removeChildren(this.element);\n        this.pool.empty();\n    };\n\n    TileView.prototype.reset = function reset () {\n        this.pool.reset();\n        this.subdomainIndex = 0;\n        this.render();\n    };\n\n    TileView.prototype.render = function render () {\n        var this$1 = this;\n\n        var size = this.tileCount(),\n            firstTileIndex = this.pointToTileIndex(this._extent.nw),\n            tile, x, y;\n\n        for (x = 0; x < size.x; x++) {\n            for (y = 0; y < size.y; y++) {\n                tile = this$1.createTile({\n                    x: firstTileIndex.x + x,\n                    y: firstTileIndex.y + y\n                });\n\n                if (!tile.visible) {\n                    tile.show();\n                }\n            }\n        }\n    };\n\n    TileView.prototype.createTile = function createTile (currentIndex) {\n        var options = this.tileOptions(currentIndex);\n        var tile = this.pool.get(this._center, options);\n\n        if (!tile.element.parentNode) {\n            this.element.append(tile.element);\n        }\n\n        return tile;\n    };\n\n    TileView.prototype.tileOptions = function tileOptions (currentIndex) {\n        var index = this.wrapIndex(currentIndex),\n            point = this.indexToPoint(currentIndex),\n            origin = this._viewOrigin,\n            offset = point.clone().translate(-origin.x, -origin.y);\n\n        return {\n            index: index,\n            currentIndex: currentIndex,\n            point: point,\n            offset: roundPoint(offset),\n            zoom: this._zoom,\n            size: this.options.tileSize,\n            subdomain: this.subdomainText(),\n            urlTemplate: this.options.urlTemplate,\n            errorUrlTemplate: this.options.errorUrlTemplate\n        };\n    };\n\n    TileView.prototype.wrapIndex = function wrapIndex (index) {\n        var boundary = math.pow(2, this._zoom);\n\n        return {\n            x: this.wrapValue(index.x, boundary),\n            y: limitValue(index.y, 0, boundary - 1)\n        };\n    };\n\n    TileView.prototype.wrapValue = function wrapValue (value, boundary) {\n        var remainder = math.abs(value) % boundary;\n        var wrappedValue = value;\n\n        if (value >= 0) {\n            wrappedValue = remainder;\n        } else {\n            wrappedValue = boundary - (remainder === 0 ? boundary : remainder);\n        }\n\n        return wrappedValue;\n    };\n\n    return TileView;\n}(Class));\n\nexport var ImageTile = (function (Class) {\n    function ImageTile(id, options) {\n        Class.call(this);\n        this.id = id;\n        this.visible = true;\n        this._initOptions(options);\n        this.createElement();\n        this.show();\n    }\n\n    if ( Class ) ImageTile.__proto__ = Class;\n    ImageTile.prototype = Object.create( Class && Class.prototype );\n    ImageTile.prototype.constructor = ImageTile;\n\n    ImageTile.prototype.destroy = function destroy () {\n        var element = this.element;\n        var parentNode = element ? element.parentNode : null;\n\n        if (element) {\n            if (parentNode) {\n                parentNode.removeChild(element);\n            }\n\n            this.element = null;\n        }\n    };\n\n    ImageTile.prototype._initOptions = function _initOptions (options) {\n        this.options = deepExtend({}, this.options, options);\n    };\n\n    ImageTile.prototype.createElement = function createElement () {\n        var el = document.createElement(\"img\");\n        addClass(el, \"k-layer\");\n        el.style.position = \"absolute\";\n        el.style.display = \"block\";\n        el.style.width = this.options.size;\n        el.style.height = this.options.size;\n\n        this.element = el;\n\n        // todo\n        // add on error handler\n\n        // this.element =\n        // $('<img style=\\'position: absolute; display: block;\\' alt=\\'\\' />')\n        // .css({\n        //     width: this.options.size,\n        //     height: this.options.size\n        // })\n        // .on('error', proxy(function(e) {\n        //     if (this.errorUrl()) {\n        //         e.target.setAttribute('src', this.errorUrl());\n        //     } else {\n        //         e.target.removeAttribute('src');\n        //     }\n        // }, this));\n    };\n\n    ImageTile.prototype.show = function show () {\n        var element = this.element;\n        element.style.top = renderSize(this.options.offset.y);\n        element.style.left = renderSize(this.options.offset.x);\n\n        var url = this.url();\n\n        if (url) {\n            element.setAttribute('src', url);\n        }\n\n        element.style.visibility = 'visible';\n        this.visible = true;\n    };\n\n    ImageTile.prototype.hide = function hide () {\n        this.element.style.visibility = 'hidden';\n        this.visible = false;\n    };\n\n    ImageTile.prototype.url = function url () {\n        var urlResult = template(this.options.urlTemplate);\n        return urlResult(this.urlOptions());\n    };\n\n    ImageTile.prototype.errorUrl = function errorUrl () {\n        var urlResult = template(this.options.errorUrlTemplate);\n        return urlResult(this.urlOptions());\n    };\n\n    ImageTile.prototype.urlOptions = function urlOptions () {\n        var options = this.options;\n\n        return {\n            zoom: options.zoom,\n            subdomain: options.subdomain,\n            z: options.zoom,\n            x: options.index.x,\n            y: options.index.y,\n            s: options.subdomain,\n            quadkey: options.quadkey,\n            q: options.quadkey,\n            culture: options.culture,\n            c: options.culture\n        };\n    };\n\n    return ImageTile;\n}(Class));\n\nsetDefaultOptions(ImageTile, {\n    urlTemplate: '',\n    errorUrlTemplate: ''\n});\n\nexport var TilePool = (function (Class) {\n    function TilePool() {\n        Class.call(this);\n        this._items = [];\n    }\n\n    if ( Class ) TilePool.__proto__ = Class;\n    TilePool.prototype = Object.create( Class && Class.prototype );\n    TilePool.prototype.constructor = TilePool;\n\n    TilePool.prototype.get = function get (center, options) {\n        if (this._items.length >= this.options.maxSize) {\n            this._remove(center);\n        }\n\n        return this._create(options);\n    };\n\n    TilePool.prototype.empty = function empty () {\n        var items = this._items;\n\n        for (var i = 0; i < items.length; i++) {\n            items[i].destroy();\n        }\n\n        this._items = [];\n    };\n\n    TilePool.prototype.reset = function reset () {\n        var items = this._items;\n\n        for (var i = 0; i < items.length; i++) {\n            items[i].hide();\n        }\n    };\n\n    TilePool.prototype._create = function _create (options) {\n        var items = this._items;\n        var tile;\n        var id = hashKey(options.point.toString() + options.offset.toString() + options.zoom + options.urlTemplate);\n\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].id === id) {\n                tile = items[i];\n                break;\n            }\n        }\n\n        if (tile) {\n            tile.show();\n        } else {\n            tile = new ImageTile(id, options);\n            this._items.push(tile);\n        }\n\n        return tile;\n    };\n\n    TilePool.prototype._remove = function _remove (center) {\n        var items = this._items;\n        var maxDist = -1;\n        var index = -1;\n\n        for (var i = 0; i < items.length; i++) {\n            var dist = items[i].options.point.distanceTo(center);\n\n            if (dist > maxDist && !items[i].visible) {\n                index = i;\n                maxDist = dist;\n            }\n        }\n\n        if (index !== -1) {\n            items[index].destroy();\n            items.splice(index, 1);\n        }\n    };\n\n    return TilePool;\n}(Class));\n\nsetDefaultOptions(TilePool, {\n    maxSize: 100\n});\n"]},"metadata":{},"sourceType":"module"}